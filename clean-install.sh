#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ —Ç–∞ –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è VS Code —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

echo "üßπ –û—á–∏—â–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π"
echo "=========================================="

# –ó—É–ø–∏–Ω—è—î–º–æ —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –ø–µ—Ä—à—ñ–π –ø–æ–º–∏–ª—Ü—ñ
set -e

echo "üì¶ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É..."
npm list --depth=0 2>/dev/null || echo "‚ÑπÔ∏è  npm list –º–∞—î –ø–æ–º–∏–ª–∫–∏ (–æ—á—ñ–∫—É–≤–∞–Ω–æ)"

echo "üóëÔ∏è  –í–∏–¥–∞–ª—è—î–º–æ node_modules —Ç–∞ package-lock.json..."
rm -rf node_modules
rm -f package-lock.json
rm -f npm-debug.log

echo "üîÑ –ü–æ–≤–Ω–µ –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
npm install

echo "üîß –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ production –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
npm install --production

echo "üßπ –û—á–∏—Å—Ç–∫–∞ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
npm prune --production

echo "üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
if npm list --production --depth=0 2>/dev/null; then
    echo "‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤ –ø–æ—Ä—è–¥–∫—É"
else
    echo "‚ö†Ô∏è  –Ñ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, –∞–ª–µ —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è VS Code —Ä–æ–∑—à–∏—Ä–µ–Ω—å"
fi

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–ª—é—á–æ–≤–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
REQUIRED_DEPS=("vscode" "node-fetch" "jsdom")
for dep in "${REQUIRED_DEPS[@]}"; do
    if npm list "$dep" --production >/dev/null 2>&1; then
        echo "‚úÖ $dep –∑–Ω–∞–π–¥–µ–Ω–æ"
    else
        echo "‚ùå $dep –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
        npm install "$dep" --save --production
    fi
done

echo "üéâ –û—á–∏—Å—Ç–∫–∞ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:"
echo "1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å: npm run lint"
echo "2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å: npm test"
echo "3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å: vsce package"
echo ""
echo "‚ÑπÔ∏è  –Ø–∫—â–æ vsce package –≤—Å–µ —â–µ –º–∞—î –ø–æ–º–∏–ª–∫–∏, —Å–ø—Ä–æ–±—É–π—Ç–µ:"
echo "   vsce package --yarn"